<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Clojurescript - Status Wiki</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-79146816-1', 'wiki.status.im');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../..">Status Wiki</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../../..">Welcome</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../getting-started/mission-and-core-values/">Mission & Core Values</a>
</li>
                            
<li >
    <a href="../../../getting-started/faq/">FAQ</a>
</li>
                            
<li >
    <a href="../../../getting-started/code-of-conduct/">Code of Conduct</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Developers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../building-status/">Building Status</a>
</li>
            
<li >
    <a href="../adding-dapps/">Adding DApps</a>
</li>
            
<li class="active">
    <a href="./">Clojurescript</a>
</li>
            
<li >
    <a href="../golang/">Golang</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../../ux-and-design/">UX & Design</a>
</li>
                            
<li >
    <a href="../../testing-and-feedback/">Testing & Feedback</a>
</li>
                            
<li >
    <a href="../../documenting/">Documenting</a>
</li>
                            
<li >
    <a href="../../marketing/">Marketing</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../community/slack/">Slack</a>
</li>
                            
<li >
    <a href="../../../community/newsletter/">Newsletter</a>
</li>
                            
<li >
    <a href="../../../community/blog/">Blog</a>
</li>
                            
<li >
    <a href="../../../community/tell-a-friend/">Tell a Friend</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Specifications <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../specifications/contact-sharing/">Contact Sharing (WIP)</a>
</li>
                            
<li >
    <a href="../../../specifications/chat-api/">Chat API (WIP)</a>
</li>
                            
<li >
    <a href="../../../specifications/discover/">Discover (WIP)</a>
</li>
                            
<li >
    <a href="../../../specifications/messaging/">Status Messaging (WIP)</a>
</li>
                            
<li >
    <a href="../../../specifications/erc20-exchange/">Exchange (WIP)</a>
</li>
                            
<li >
    <a href="../../../specifications/sticker-market/">Sticker Market (WIP)</a>
</li>
                            
<li >
    <a href="../../../specifications/visual-programming/">Visual Programming (WIP)</a>
</li>
                            
<li >
    <a href="../../../specifications/moments/">Moments (WIP)</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">License <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../licenses/mpl2/">MPL2</a>
</li>
                            
<li >
    <a href="../../../licenses/lgpl-v3.0-static/">LGPLv3-static</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../adding-dapps/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../golang/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#clojurescript">Clojurescript</a></li>
            <li><a href="#project-structure-out-of-date">Project Structure (out of date)</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="clojurescript">Clojurescript</h1>
<p>https://github.com/status-im/status-react</p>
<h2 id="project-structure-out-of-date">Project Structure (out of date)</h2>
<ol>
<li>The structure of the project was changed from
   ```
syng_im<ul>
<li>handlers.cljs</li>
<li>subs.cljs</li>
<li>models</li>
<li>components<ul>
<li>chats</li>
<li>contatcs</li>
<li>react.cljs</li>
</ul>
</li>
</ul>
</li>
</ol>
<pre><code>   to
    ```
syng_im
   - chat 
       - handlers.cljs
       - subs.cljs
       - views
       - styles
       - screen.cljs
   - contacts
      ...
   ....
   - components
   - handlers.cljs
   - subs.cljs
</code></pre>

<p>So previously <code>syng-im.handlers</code> ns contained all handlers, now it is the point where all handlers are required, and the place for very common handlers (like <code>:set</code>).
<code>syng-im.subs</code> ns contained all subscriptions, but now it has to contain only common handlers, like <code>:get</code>. Everything specific to particular feature/screen (like <code>chat</code>/<code>contacts</code>/<code>navigation</code> etc), including specific handlers, subs, views etc. should be placed inside feature's dir. This helps to simplify reasoning about the particular feature by avoiding of mixing of code with unrelated functionality inside one namespace. We still have <code>components</code> which will contain common components and views like <code>text</code>/<code>view</code>/<code>carousel</code> etc, that can be used inside other <code>views</code></p>
<ol>
<li>
<p>Views must not contain any logic related to control on applications data (changing of state, specific validation/checks of data etc...). The only way to work with app-db inside views is to subscribe to particular data from app-db and dispatch events to handlers.</p>
</li>
<li>
<p>Styles. Views should be free of styles definitions but only reference to them. Everything related to presentation should be moved to <code>feature.styles</code>/<code>components.component-name.styles</code> ns. If there is any logic related to the presentation which should be computed based on data it is fine to write a function which will take that data as parameters and return styles.</p>
</li>
<li>
<p>Handlers. The idea is to keep handlers pure as far as it possible and don't mix code that contains side-effects with code that is pure. The code that contains <code>side-effects</code> shouldn't contain any application's logic. It means that if we have handler like
   <code>(register-handler  :load-messages
    (-&gt; load-messages!
         ((enrich add-messages)))))</code>
everything related to applications logic (like processing of messages after loading, adding messages to app-db, etc) should be placed inside <code>add-messages</code> function, when <code>load-messages!</code> only contains a call to external api/db/whatever outside app-db. In this case, all handlers which contain applications logic are pure and that means that they are testable (I hope we will get to tests once).</p>
</li>
<li>
<p>Subs. Nothing specific. Just keep them in right namespaces.</p>
</li>
</ol>
<p><strong>Common things:</strong></p>
<ol>
<li>
<p>Namespaces should not contain all other namespaces in <code>require</code> form. Just keep there namespaces/refers that are really used.</p>
</li>
<li>
<p>Models shouldn't contain any logic wich not related to fetching data from db. </p>
</li>
<li>
<p>There is no need to gather "paths" inside <code>syng-im.db</code> ns. This only leads to coupled code with a lot of senseless references. For instance to code like this
   ```
   (register-handler :change-message
     (fn [db [_ message]]
       (change-message db message)))</p>
</li>
</ol>
<p>(defn change-message [db message]
     (assoc-in db (message-path (get-current-chat-id id)) message))</p>
<p>(defn message-path [chat-id]
     [:chats chat-id :message])</p>
<p>(defn get-curent-chat-id [db]
     (get-in db current-chat-id-path))</p>
<p>(def current-chat-id-path :current-chat-id)</p>
<pre><code>where these functions are placed in three different namespaces, when it can be just
   ```
(register-handler :change-message
     (fn [{:keys [current-chat-id] :as db} [_ message]]
       (assoc-in db [:chats current-chat-id :message] message)))
</code></pre>

<ol>
<li>Specific properties that are used everywhere for same components better to move to components definition than to repeat each time when a component is used. Like <code>:underlineColorAndroid :transparent</code> for <code>text-input</code></li>
</ol>
<p>And so on... Other things are more related to Clojure, not to application's or <code>re-frame</code>'s architecture.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
